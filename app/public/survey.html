<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Survey Page</title>

    <!-- Latest compiled and minified CSS,JS and most recent version on Font Awesome 5.6.3. -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <style>
        body {
              background-color: rgb(219, 182, 236);
            }
            </style>
</head>

<body>
    <!-- Survey form starts here. Inputs for name and profile picture link. ++++++++++++++++++++++++++++++++++++++-->
    <div class="container">
        <div class="jumbotron bg-primary text-white text-center">
            <h1 class="display-4"> <i class="far fa-edit"></i> Survey!</h1>
            <hr>
            <p class="h5"> Tell us a little about your likes and dislikes!</p>
        </div>
        <form>
            <div class="form-group">
                <label for="username">Your name (Required)</label>
                <input type="text" class="form-control" id="username">
            </div>
            <div class="form-group">
                <label for="userimage">Enter a link of your profile picture (Required)</label>
                <input type="text" class="form-control" id="userimage">
            </div>

            <!-- Survey Questions start here. Taken from Bootstrap Custom form-groups +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
            <div class="form-group">
                <h4>
                    <div class="text-center">Don't be shy! Tell us how you really feel!</div>
                </h4>
                <label for="Q1">'Mad Men' is a fantastic show!</label>

                <select class="form-control col-md-6" id="Q1">
                    <option value="" selected disabled>Please Select</option>
                    <option value="1">Strongly disagree</option>
                    <option value="2">Somewhat disagree</option>
                    <option value="3">No opinion</option>
                    <option value="4">Somewhat agree</option>
                    <option value="5">Strongly agree</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Q2">'The Simpsons' was funny but has since jumped the shark!</label>
                <select class="form-control col-md-6" id="Q2">
                    <option value="" selected disabled>Please Select</option>
                    <option value="1">Strongly disagree</option>
                    <option value="2">Somewhat disagree</option>
                    <option value="3">No opinion</option>
                    <option value="4">Somewhat agree</option>
                    <option value="5">Strongly agree</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Q3">I know where the term 'Jumped the shark' originated. It comes from the TV show: </label>
                <select class="form-control col-md-6" id="Q3">
                    <option value="" selected disabled>Please Select</option>
                    <option value="0">Three's Company</option>
                    <option value="0">The Facts of Life</option>
                    <option value="0">M*A*S*H</option>
                    <option value="5">Happy Days</option>
                    <option value="0">Knight Rider</option>
                </select>
                </select>
            </div>
            <div class="form-group">
                <label for="Q4">The UK version of 'The Office' is better than the US version.</label>
                <select class="form-control col-md-6" id="Q4">
                    <option value="" selected disabled>Please Select</option>
                    <option value="1">Strongly disagree</option>
                    <option value="2">Somewhat disagree</option>
                    <option value="3">No opinion</option>
                    <option value="4">Somewhat agree</option>
                    <option value="5">Strongly agree</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Q5">ESPN doesn't do it for me anymore.</label>
                <select class="form-control col-md-6" id="Q5">
                    <option value="" selected disabled>Please Select</option>
                    <option value="1">Strongly disagree</option>
                    <option value="2">Somewhat disagree</option>
                    <option value="3">No opinion</option>
                    <option value="4">Somewhat agree</option>
                    <option value="5">Strongly agree</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Q6">'Bob's Burgers' > 'Rick & Morty > 'Family Guy'.</label>
                <select class="form-control col-md-6" id="Q6">
                    <option value="" selected disabled>Please Select</option>
                    <option value="1">Strongly disagree</option>
                    <option value="2">Somewhat disagree</option>
                    <option value="3">No opinion</option>
                    <option value="4">Somewhat agree</option>
                    <option value="5">Strongly agree</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Q7">'Community' is better than 'Big Bang Theory'.</label>
                <select class="form-control col-md-6" id="Q7">
                    <option value="" selected disabled>Please Select</option>
                    <option value="1">Strongly disagree</option>
                    <option value="2">Somewhat disagree</option>
                    <option value="3">No opinion</option>
                    <option value="4">Somewhat agree</option>
                    <option value="5">Strongly agree</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Q8">'Saturday Night Live' is overrated.</label>
                <select class="form-control col-md-6" id="Q8">
                    <option value="" selected disabled>Please Select</option>
                    <option value="1">Strongly disagree</option>
                    <option value="2">Somewhat disagree</option>
                    <option value="3">No opinion</option>
                    <option value="4">Somewhat agree</option>
                    <option value="5">Strongly agree</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Q9">I think Tony Soprano gets whacked in the series' last episode.</label>
                <select class="form-control col-md-6" id="Q9">
                    <option value="" selected disabled>Please Select</option>
                    <option value="1">Strongly disagree</option>
                    <option value="2">Somewhat disagree</option>
                    <option value="3">No opinion</option>
                    <option value="4">Somewhat agree</option>
                    <option value="5">Strongly agree</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Q10"> Marvel movies are better than DC movies.</label>
                <select class="form-control col-md-6" id="Q10">
                    <option value="" selected disabled>Please Select</option>
                    <option value="1">Strongly disagree</option>
                    <option value="2">Somewhat disagree</option>
                    <option value="3">No opinion</option>
                    <option value="4">Somewhat agree</option>
                    <option value="5">Strongly agree</option>
                </select>
            </div>
        </form>
        <br><br>
        <a id="submitButtonId" class="btn-lg btn-block btn-primary text-white text-center">Submit</a>

        <br><br>
        <!-- Modal starts here. This code taken from Bootstrap Modals +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <div class="modal fade bd-example-modal-lg" id="myModal" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">We found your friend!</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p id="modalTxt"></p>
                        <div>
                            <img id="imageId" style="width: 420px; height: 350px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <p><a href="/api/friends" target="_blank">API Friends List</a> | <a href="https://github.com/MWorthington888/FriendFinder"
                target="_blank">GitHub Repo</a></p>
        <br>
    </div>
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <script>
        // This pushes the value of each answer into an array -----------------------------------
        $("#submitButtonId").click(function () {
            event.preventDefault();
            const answerValues = [];
            for (var i = 1; i < 11; i++) {
                answerValues .push(parseInt($("#Q" + i).val().trim()));
            }
            // This section takes user's name, picture link and array of answer values and places this data into a variable ----
            const newUserProfile = {
                name: $("#username").val().trim(),
                scores: answerValues,
                image: $("#userimage").val().trim()
            }
            // This section creates three arrays where we will push values, names and images from api/friends JSON data -------
            const apiFriendsScores = [];
            const apiFriendsNames = [];
            const apiFriendsImages = [];
            $.get("/api/friends", function (data) {
                for (var i = 0; i < data.length; i++) {
                    apiFriendsScores.push(data[i].scores);
                    apiFriendsNames.push(data[i].name);
                    apiFriendsImages.push(data[i].image);
                }
            })
            // Here we calculate the total value differences between the user and friends located in our API ------------------
            // Resourced from MDN Web Docs from Mozilla
            $.post("/api/friends", newUserProfile, function (data) {
                const differenceArray = [];
                for (var i = 0; i < apiFriendsScores.length; i++) {
                    var diff = 0;
                    for (var k = 0; k < apiFriendsScores[i].length; k++) {
                        diff += Math.abs(apiFriendsScores[i][k] - data.scores[k]);
                    }
                    differenceArray.push(diff);
                }
                // (Math.min ...array) returns our lowest value. This lowest value represents our closest friend match to the user. ------
                // Resourced from MDN Web Docs from Mozilla
                const smallestDifferenceIn = differenceArray.indexOf(Math.min(...differenceArray));
                const match = apiFriendsNames[smallestDifferenceIn];
                const image = apiFriendsImages[smallestDifferenceIn];
                $("#myModal").modal("toggle");
                $("#modalTxt").text("You're most compatible with " + match + "!");
                $("#imageId").attr("src", image);
            });
            // This blows of the survey data ----------------------------------------------------------
            $("#username").val("");
            for (var i = 1; i < 11; i++) {
                $("#Q" + i).val("");
            }
        })
    </script>
</body>

</html>